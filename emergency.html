<!DOCTYPE html>
<html>
<head>
  <title>Emergency Navigation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f0f0f0;
    }
    
    .emergency-notice {
      background-color: #ff5722;
      color: white;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .status-box {
      background-color: #e8f5e8;
      border: 2px solid #4caf50;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    
    .nav-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    
    .nav-card {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #ddd;
      text-align: center;
    }
    
    .nav-card h3 {
      margin-top: 0;
      color: #333;
    }
    
    .nav-button {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      padding: 12px 24px;
      margin: 5px;
      text-decoration: none;
      border-radius: 5px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      width: 90%;
    }
    
    .nav-button:hover {
      background-color: #45a049;
    }
    
    .working {
      background-color: #4CAF50;
    }
    
    .broken {
      background-color: #f44336;
    }
    
    .unknown {
      background-color: #ff9800;
    }
    
    .debug-section {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="emergency-notice">
    <strong>üö® EMERGENCY NAVIGATION MODE</strong><br>
    Auth system bypassed - Using direct access to fix infinite loops
  </div>

  <div class="status-box">
    <h2>üõ†Ô∏è System Status Check</h2>
    <p><strong>Current Issue:</strong> Dashboard authentication causing infinite redirect loops</p>
    <p><strong>Workaround:</strong> Direct page access without auth checks</p>
  </div>

  <div class="nav-grid">
    <div class="nav-card">
      <h3>‚úÖ Working Pages</h3>
      <p>These pages work because they have minimal auth:</p>
      <a href="create-trial.html" class="nav-button working">Create Trial</a>
      <a href="index.html" class="nav-button working">Login Page</a>
    </div>

    <div class="nav-card">
      <h3>‚ùå Broken Pages</h3>
      <p>These redirect to dashboard (causing loop):</p>
      <button class="nav-button broken" onclick="testPage('view-trials.html')">Test View Trials</button>
      <button class="nav-button broken" onclick="testPage('trial-application.html')">Test Trial App</button>
      <button class="nav-button broken" onclick="testPage('premium-generator.html')">Test Premium</button>
      <button class="nav-button broken" onclick="testPage('waiver-generator.html')">Test Waiver</button>
    </div>

    <div class="nav-card">
      <h3>üîß Emergency Tools</h3>
      <p>Tools to diagnose and fix:</p>
      <button class="nav-button unknown" onclick="clearAllData()">Clear All Browser Data</button>
      <button class="nav-button unknown" onclick="showStorageInfo()">Show Storage Info</button>
      <button class="nav-button unknown" onclick="testFirebase()">Test Firebase Connection</button>
    </div>

    <div class="nav-card">
      <h3>üìã Quick Actions</h3>
      <p>Direct actions you can take:</p>
      <button class="nav-button working" onclick="createBackup()">Backup Current Data</button>
      <button class="nav-button working" onclick="showFiles()">Show File List</button>
      <button class="nav-button working" onclick="resetSystem()">Reset System</button>
    </div>
  </div>

  <div class="debug-section">
    <h3>üîç Debug Information</h3>
    <div id="debugOutput">
      <p>Click "Show Storage Info" to see current browser state...</p>
    </div>
  </div>

  <script type="module">
    console.log("Emergency navigation page loaded");

    window.testPage = function(pageName) {
      console.log(`Testing page: ${pageName}`);
      const testWindow = window.open(pageName, '_blank');
      
      setTimeout(() => {
        try {
          if (testWindow.location.href.includes('dashboard.html')) {
            alert(`‚ùå ${pageName} redirected to dashboard (broken)`);
            testWindow.close();
          } else {
            alert(`‚úÖ ${pageName} loaded successfully!`);
          }
        } catch (e) {
          alert(`‚ö†Ô∏è ${pageName} - Cannot determine status (probably blocked by CORS)`);
        }
      }, 2000);
    };

    window.clearAllData = function() {
      try {
        localStorage.clear();
        sessionStorage.clear();
        
        // Clear any indexed DB if it exists
        if ('indexedDB' in window) {
          indexedDB.deleteDatabase('firebaseLocalStorageDb');
        }
        
        alert("‚úÖ All browser data cleared! Try refreshing or opening a new incognito window.");
      } catch (error) {
        alert("‚ùå Error clearing data: " + error.message);
      }
    };

    window.showStorageInfo = function() {
      const debugDiv = document.getElementById('debugOutput');
      
      let info = '<h4>Browser Storage Status:</h4>';
      info += `<p><strong>Local Storage:</strong> ${localStorage.length} items</p>`;
      info += `<p><strong>Session Storage:</strong> ${sessionStorage.length} items</p>`;
      info += `<p><strong>URL:</strong> ${window.location.href}</p>`;
      info += `<p><strong>Timestamp:</strong> ${new Date().toLocaleString()}</p>`;
      
      // Show localStorage contents
      if (localStorage.length > 0) {
        info += '<h5>LocalStorage Contents:</h5><ul>';
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          const value = localStorage.getItem(key);
          info += `<li><strong>${key}:</strong> ${value.substring(0, 100)}...</li>`;
        }
        info += '</ul>';
      }
      
      debugDiv.innerHTML = info;
    };

    window.testFirebase = async function() {
      try {
        const { auth } = await import('./js/firebase.js');
        console.log("Firebase auth object:", auth);
        alert("‚úÖ Firebase connection successful!");
      } catch (error) {
        console.error("Firebase test failed:", error);
        alert("‚ùå Firebase connection failed: " + error.message);
      }
    };

    window.createBackup = function() {
      const backup = {
        localStorage: { ...localStorage },
        sessionStorage: { ...sessionStorage },
        timestamp: new Date().toISOString(),
        url: window.location.href
      };
      
      const dataStr = JSON.stringify(backup, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup_${new Date().getTime()}.json`;
      link.click();
      
      alert("‚úÖ Backup file downloaded!");
    };

    window.showFiles = function() {
      const files = [
        'index.html',
        'dashboard.html',
        'create-trial.html',
        'view-trials.html',
        'trial-application.html',
        'premium-generator.html',
        'waiver-generator.html',
        'js/firebase.js',
        'js/dashboard.js',
        'js/create-trial.js',
        'js/view-trials.js',
        'js/trial-application.js'
      ];
      
      const debugDiv = document.getElementById('debugOutput');
      debugDiv.innerHTML = '<h4>Project Files:</h4><ul>' + 
        files.map(file => `<li>${file}</li>`).join('') + 
        '</ul><p><em>These are the files that need to be checked for auth loops.</em></p>';
    };

    window.resetSystem = function() {
      if (confirm("This will clear all data and refresh the page. Continue?")) {
        clearAllData();
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      }
    };
  </script>
</body>
</html>
