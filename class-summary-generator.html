<!DOCTYPE html>
<html>
<head>
  <title>Class Summary Generator</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      padding: 30px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #eee;
    }
    
    .header h1 {
      color: #333;
      margin-bottom: 10px;
    }
    
    .back-button {
      background-color: #007cba;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin-bottom: 20px;
      text-decoration: none;
      display: inline-block;
    }
    
    .back-button:hover {
      background-color: #005a8b;
    }
    
    .form-section {
      background: #f8f9fa;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }
    
    .form-section h2 {
      margin-top: 0;
      color: #333;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .class-container {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .class-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .class-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }
    
    .dates-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    
    .date-row {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .entries-section {
      margin-top: 20px;
    }
    
    .entries-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    .entries-table th,
    .entries-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    
    .entries-table th {
      background: #f8f9fa;
      font-weight: bold;
    }
    
    .result-select {
      width: 100%;
      padding: 4px;
      border: 1px solid #ddd;
      border-radius: 3px;
    }
    
    .btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 5px;
    }
    
    .btn:hover {
      background: #45a049;
    }
    
    .btn-danger {
      background: #dc3545;
    }
    
    .btn-danger:hover {
      background: #c82333;
    }
    
    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }
    
    .btn-success {
      background: #28a745;
    }
    
    .btn-primary {
      background: #007bff;
    }
    
    .btn-purple {
      background: #6f42c1;
    }
    
    .action-buttons {
      text-align: center;
      margin: 30px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .action-buttons .btn {
      margin: 0 10px;
      padding: 12px 24px;
      font-size: 16px;
    }
    
    .preview-section {
      margin-top: 30px;
      padding: 20px;
      background: #f1f3f4;
      border-radius: 8px;
    }
    
    .preview-section h2 {
      color: #333;
      text-align: center;
    }
    
    .preview-class {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    
    .preview-class h3 {
      text-align: center;
      margin-bottom: 10px;
      color: #333;
    }
    
    .loading {
      text-align: center;
      color: #666;
      font-style: italic;
    }
    
    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
    
    .success {
      background: #d4edda;
      color: #155724;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="main-dashboard.html" class="back-button">‚Üê Back to Dashboard</a>
    
    <div class="header">
      <h1>üêï C-WAGS Class Summary Generator</h1>
      <p>Create and manage class summary reports for trials</p>
    </div>

    <div id="loadingMessage" class="loading" style="display: none;">
      Loading summary data...
    </div>

    <div id="errorMessage" class="error" style="display: none;"></div>
    <div id="successMessage" class="success" style="display: none;"></div>

    <!-- Trial Information Section -->
    <div class="form-section">
      <h2>Trial Information</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="hostName">Host Name:</label>
          <input type="text" id="hostName" placeholder="e.g., DOG GROUP">
        </div>
        <div class="form-group">
          <label for="dateRange">Date Range:</label>
          <input type="text" id="dateRange" placeholder="e.g., July 1 ‚Äì August 5, 2025">
        </div>
      </div>
    </div>

    <!-- Classes Section -->
    <div id="classesContainer"></div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-purple" onclick="addClass()">+ Add Another Class</button>
      <div>
        <button class="btn btn-success" onclick="saveSummary()">üíæ Save Summary</button>
        <button class="btn btn-primary" onclick="generateReport()">üìÑ Generate Report</button>
      </div>
    </div>

    <!-- Preview Section -->
    <div class="preview-section">
      <h2>üìã Report Preview</h2>
      <div id="previewContainer">
        <p class="loading">Add classes to see preview...</p>
      </div>
    </div>
  </div>

  <script type="module">
    // Firebase imports
    import { auth, db } from './js/firebase.js';
    import { collection, addDoc, doc, getDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

    // ========================================
    // STANDARDIZED FIELD NAMES (CRITICAL FIX)
    // ========================================

    // Use these EXACT field names everywhere:
    const STANDARD_FIELDS = {
      HANDLER_NAME: 'handlerName',      // NOT 'Handler' or 'handler'
      DOG_CALL_NAME: 'dogCallName',     // NOT 'dogName' or 'callName'
      JUDGE_NAME: 'judgeName',          // NOT 'judge' or 'judgeAssigned'
      CLASS_NAME: 'className',          // NOT 'Class'
      CWAGS_NUMBER: 'cwagsNumber'
    };

    // Function to normalize entry data to standard field names
    function normalizeEntryData(entryData) {
      const normalized = { ...entryData };
      
      // Normalize dog call name (CRITICAL FIX)
      if (entryData.dogName && !entryData.dogCallName) {
        normalized.dogCallName = entryData.dogName;
        delete normalized.dogName; // Remove old field
      }
      
      // Normalize handler name
      if (entryData.Handler && !entryData.handlerName) {
        normalized.handlerName = entryData.Handler;
      }
      if (entryData.handler && !entryData.handlerName) {
        normalized.handlerName = entryData.handler;
      }
      
      // Normalize judge name
      if (entryData.judge && !entryData.judgeName) {
        normalized.judgeName = entryData.judge;
      }
      
      return normalized;
    }

    // Global variables
    let summaryData = {
      hostName: '',
      dateRange: '',
      classes: []
    };
    
    let currentSummaryId = null;

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      console.log("Class Summary Generator initializing...");
      
      // Check for edit mode
      const urlParams = new URLSearchParams(window.location.search);
      const editId = urlParams.get('edit');
      const viewId = urlParams.get('view');
      
      if (editId) {
        loadExistingSummary(editId);
      } else if (viewId) {
        loadExistingSummary(viewId, true); // View mode
      } else {
        // Start with one empty class
        addClass();
      }
      
      // Setup event listeners
      document.getElementById('hostName').addEventListener('input', updateBasicInfo);
      document.getElementById('dateRange').addEventListener('input', updateBasicInfo);
    });

    // ========================================
    // BASIC INFO MANAGEMENT
    // ========================================

    function updateBasicInfo() {
      summaryData.hostName = document.getElementById('hostName').value;
      summaryData.dateRange = document.getElementById('dateRange').value;
      updatePreview();
    }

    // ========================================
    // CLASS MANAGEMENT
    // ========================================

    window.addClass = function() {
      const newClass = {
        id: summaryData.classes.length + 1,
        name: '',
        dates: [],
        entries: []
      };
      
      summaryData.classes.push(newClass);
      renderClasses();
      updatePreview();
    };

    function removeClass(classIndex) {
      summaryData.classes.splice(classIndex, 1);
      // Re-number classes
      summaryData.classes.forEach((cls, index) => {
        cls.id = index + 1;
      });
      renderClasses();
      updatePreview();
    }

    function updateClassName(classIndex, name) {
      summaryData.classes[classIndex].name = name;
      updatePreview();
    }

    // ========================================
    // DATE MANAGEMENT
    // ========================================

    function addDate(classIndex) {
      if (!summaryData.classes[classIndex].dates) {
        summaryData.classes[classIndex].dates = [];
      }
      
      summaryData.classes[classIndex].dates.push({
        date: '',
        judge: ''
      });
      
      // Update all existing entries to have results for the new date
      summaryData.classes[classIndex].entries.forEach(entry => {
        if (!entry.results) entry.results = [];
        entry.results.push('');
      });
      
      renderClasses();
      updatePreview();
    }

    function removeDate(classIndex, dateIndex) {
      summaryData.classes[classIndex].dates.splice(dateIndex, 1);
      
      // Remove results for this date from all entries
      summaryData.classes[classIndex].entries.forEach(entry => {
        if (entry.results) {
          entry.results.splice(dateIndex, 1);
        }
      });
      
      renderClasses();
      updatePreview();
    }

    function updateDate(classIndex, dateIndex, field, value) {
      summaryData.classes[classIndex].dates[dateIndex][field] = value;
      updatePreview();
    }

    // ========================================
    // ENTRY MANAGEMENT WITH STANDARDIZED FIELDS
    // ========================================

    function addEntry(classIndex) {
      if (!summaryData.classes[classIndex].entries) {
        summaryData.classes[classIndex].entries = [];
      }
      
      const numDates = summaryData.classes[classIndex].dates ? summaryData.classes[classIndex].dates.length : 0;
      
      summaryData.classes[classIndex].entries.push({
        registrationNumber: '',
        dogCallName: '',        // STANDARDIZED: Use dogCallName, not dogName
        handlerName: '',        // STANDARDIZED: Use handlerName
        results: new Array(numDates).fill('')
      });
      
      renderClasses();
      updatePreview();
    }

    function removeEntry(classIndex, entryIndex) {
      summaryData.classes[classIndex].entries.splice(entryIndex, 1);
      renderClasses();
      updatePreview();
    }

    // CRITICAL FIX: Update entry function with field name mapping
    function updateEntry(classIndex, entryIndex, field, value) {
      // Map old field names to standardized ones
      const fieldMapping = {
        'dogName': 'dogCallName',     // CRITICAL: Map dogName to dogCallName
        'handler': 'handlerName',
        'judge': 'judgeName'
      };
      
      const standardField = fieldMapping[field] || field;
      summaryData.classes[classIndex].entries[entryIndex][standardField] = value;
      updatePreview();
    }

    function updateResult(classIndex, entryIndex, dateIndex, value) {
      if (!summaryData.classes[classIndex].entries[entryIndex].results) {
        summaryData.classes[classIndex].entries[entryIndex].results = [];
      }
      summaryData.classes[classIndex].entries[entryIndex].results[dateIndex] = value;
      updatePreview();
    }

    // ========================================
    // RENDERING FUNCTIONS WITH STANDARDIZED FIELDS
    // ========================================

    function renderClasses() {
      const container = document.getElementById('classesContainer');
      
      const html = summaryData.classes.map((classItem, classIndex) => `
        <div class="class-container">
          <div class="class-header">
            <div class="class-title">Class ${classItem.id}</div>
            <button class="btn btn-danger btn-sm" onclick="removeClass(${classIndex})">Remove Class</button>
          </div>
          
          <div class="form-group">
            <label>Class Name:</label>
            <input type="text" value="${classItem.name}" 
                   onchange="updateClassName(${classIndex}, this.value)"
                   placeholder="e.g., Novice Birch">
          </div>
          
          <div class="dates-section">
            <h4>Dates & Judges</h4>
            ${renderDates(classItem, classIndex)}
            <button class="btn btn-sm" onclick="addDate(${classIndex})">+ Add Date</button>
          </div>
          
          <div class="entries-section">
            <h4>Entries (${classItem.entries ? classItem.entries.length : 0} dogs)</h4>
            ${renderEntriesTableWithStandardizedFields(classItem, classIndex)}
            <button class="btn btn-sm" onclick="addEntry(${classIndex})">+ Add Entry</button>
          </div>
        </div>
      `).join('');
      
      container.innerHTML = html;
    }

    function renderDates(classItem, classIndex) {
      if (!classItem.dates || classItem.dates.length === 0) {
        return '<p style="color: #666; font-style: italic;">No dates added yet.</p>';
      }
      
      return classItem.dates.map((date, dateIndex) => `
        <div class="date-row">
          <input type="date" value="${date.date}" 
                 onchange="updateDate(${classIndex}, ${dateIndex}, 'date', this.value)"
                 placeholder="Select date">
          <input type="text" value="${date.judge}" 
                 onchange="updateDate(${classIndex}, ${dateIndex}, 'judge', this.value)"
                 placeholder="Judge name">
          <button class="btn btn-danger btn-sm" onclick="removeDate(${classIndex}, ${dateIndex})">Remove</button>
        </div>
      `).join('');
    }

    // CRITICAL FIX: Updated entries table using standardized field names
    function renderEntriesTableWithStandardizedFields(classItem, classIndex) {
      if (!classItem.entries || classItem.entries.length === 0 || !classItem.dates || classItem.dates.length === 0) {
        return '<p style="color: #666; font-style: italic;">Add dates and dogs to start building your class report.</p>';
      }
      
      return `
        <table class="entries-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Registration Number</th>
              <th>Dog's Call Name</th>
              <th>Handler</th>
              ${classItem.dates.map((date, dateIndex) => `
                <th>${date.date}<br>${date.judge}</th>
              `).join('')}
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${classItem.entries.map((entry, entryIndex) => {
              // Normalize entry data to ensure we use standard field names
              const normalizedEntry = normalizeEntryData(entry);
              
              return `
                <tr>
                  <td>${entryIndex + 1}</td>
                  <td>
                    <input type="text" value="${normalizedEntry.registrationNumber || ''}" 
                           onchange="updateEntry(${classIndex}, ${entryIndex}, 'registrationNumber', this.value)"
                           placeholder="Reg #">
                  </td>
                  <td>
                    <input type="text" value="${normalizedEntry.dogCallName || ''}" 
                           onchange="updateEntry(${classIndex}, ${entryIndex}, 'dogCallName', this.value)"
                           placeholder="Dog Call Name">
                  </td>
                  <td>
                    <input type="text" value="${normalizedEntry.handlerName || ''}" 
                           onchange="updateEntry(${classIndex}, ${entryIndex}, 'handlerName', this.value)"
                           placeholder="Handler Name">
                  </td>
                  ${classItem.dates.map((date, dateIndex) => `
                    <td>
                      <select class="result-select" 
                              onchange="updateResult(${classIndex}, ${entryIndex}, ${dateIndex}, this.value)"
                              value="${normalizedEntry.results && normalizedEntry.results[dateIndex] ? normalizedEntry.results[dateIndex] : ''}">
                        <option value="">-</option>
                        <option value="Pass" ${normalizedEntry.results && normalizedEntry.results[dateIndex] === 'Pass' ? 'selected' : ''}>Pass</option>
                        <option value="Fail" ${normalizedEntry.results && normalizedEntry.results[dateIndex] === 'Fail' ? 'selected' : ''}>Fail</option>
                        <option value="XX" ${normalizedEntry.results && normalizedEntry.results[dateIndex] === 'XX' ? 'selected' : ''}>XX</option>
                      </select>
                    </td>
                  `).join('')}
                  <td>
                    <button onclick="removeEntry(${classIndex}, ${entryIndex})" class="btn btn-danger btn-sm">Remove</button>
                  </td>
                </tr>
              `;
            }).join('')}
          </tbody>
        </table>
      `;
    }

    // ========================================
    // PREVIEW GENERATION WITH STANDARDIZED FIELDS
    // ========================================

    function updatePreview() {
      const container = document.getElementById('previewContainer');
      
      if (!summaryData.hostName && !summaryData.dateRange && summaryData.classes.length === 0) {
        container.innerHTML = '<p class="loading">Add trial information and classes to see preview...</p>';
        return;
      }
      
      const previewHTML = `
        <div class="preview-header" style="text-align: center; margin-bottom: 30px;">
          <h2>C-WAGS Class Results</h2>
          <h3>${summaryData.hostName || '[Host Name]'}</h3>
          <p><strong>Trial Dates:</strong> ${summaryData.dateRange || '[Date Range]'}</p>
        </div>
        
        ${summaryData.classes.map(classItem => `
          <div class="preview-class">
            <h3>${classItem.name || '[Class Name]'}</h3>
            <p><strong>Total Entries:</strong> ${classItem.entries ? classItem.entries.length : 0}</p>
            
            ${classItem.entries && classItem.entries.length > 0 && classItem.dates && classItem.dates.length > 0 ? `
              <table class="entries-table" style="margin-top: 15px;">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Registration Number</th>
                    <th>Dog's Call Name</th>
                    <th>Handler</th>
                    ${classItem.dates.map(date => `
                      <th style="text-align: center;">
                        ${date.date}<br/>${date.judge}
                      </th>
                    `).join('')}
                  </tr>
                </thead>
                <tbody>
                  ${classItem.entries.map((entry, entryIndex) => {
                    // Normalize entry for display
                    const normalizedEntry = normalizeEntryData(entry);
                    
                    return `
                      <tr>
                        <td style="text-align: center;">${entryIndex + 1}</td>
                        <td>${normalizedEntry.registrationNumber || ''}</td>
                        <td>${normalizedEntry.dogCallName || ''}</td>
                        <td>${normalizedEntry.handlerName || ''}</td>
                        ${classItem.dates.map((date, dateIndex) => `
                          <td style="text-align: center;">
                            ${normalizedEntry.results && normalizedEntry.results[dateIndex] ? normalizedEntry.results[dateIndex] : ''}
                          </td>
                        `).join('')}
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            ` : `
              <p style="color: #666; font-style: italic; margin-top: 15px;">
                Add dates and entries to see the complete report preview.
              </p>
            `}
          </div>
        `).join('')}
      `;
      
      container.innerHTML = previewHTML || '<p class="loading">Add classes to see preview...</p>';
    }

    // ========================================
    // SAVE/LOAD FUNCTIONALITY WITH STANDARDIZED FIELDS
    // ========================================

    async function saveToFirebase(data) {
      try {
        // Normalize all entry data before saving
        const normalizedData = {
          ...data,
          classes: data.classes.map(classItem => ({
            ...classItem,
            entries: classItem.entries ? classItem.entries.map(entry => normalizeEntryData(entry)) : []
          }))
        };
        
        const docRef = await addDoc(collection(db, 'classSummaries'), {
          ...normalizedData,
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp(),
          createdBy: auth.currentUser.uid
        });
        
        return docRef.id;
      } catch (error) {
        console.error('Error saving to Firebase:', error);
        throw error;
      }
    }

    async function updateInFirebase(id, data) {
      try {
        // Normalize all entry data before updating
        const normalizedData = {
          ...data,
          classes: data.classes.map(classItem => ({
            ...classItem,
            entries: classItem.entries ? classItem.entries.map(entry => normalizeEntryData(entry)) : []
          }))
        };
        
        await updateDoc(doc(db, 'classSummaries', id), {
          ...normalizedData,
          updatedAt: serverTimestamp()
        });
      } catch (error) {
        console.error('Error updating Firebase:', error);
        throw error;
      }
    }

    async function loadExistingSummary(summaryId, viewMode = false) {
      try {
        showLoading('Loading summary...');
        
        const summaryDoc = await getDoc(doc(db, 'classSummaries', summaryId));
        
        if (summaryDoc.exists()) {
          const data = summaryDoc.data();
          
          // Normalize loaded data to ensure standard field names
          summaryData = {
            ...data,
            classes: data.classes ? data.classes.map(classItem => ({
              ...classItem,
              entries: classItem.entries ? classItem.entries.map(entry => normalizeEntryData(entry)) : []
            })) : []
          };
          
          currentSummaryId = summaryId;
          
          // Populate form
          document.getElementById('hostName').value = summaryData.hostName || '';
          document.getElementById('dateRange').value = summaryData.dateRange || '';
          
          if (summaryData.classes.length === 0) {
            addClass();
          } else {
            renderClasses();
          }
          
          updatePreview();
          
          if (viewMode) {
            // Disable editing in view mode
            document.querySelectorAll('input, select, button').forEach(el => {
              if (!el.textContent.includes('Back')) {
                el.disabled = true;
              }
            });
          }
          
        } else {
          showError('Summary not found');
        }
        
      } catch (error) {
        console.error('Error loading summary:', error);
        showError('Error loading summary: ' + error.message);
      } finally {
        hideLoading();
      }
    }

    // ========================================
    // MAIN ACTION FUNCTIONS
    // ========================================

    window.saveSummary = async function() {
      try {
        showLoading('Saving summary...');
        
        if (!summaryData.hostName || !summaryData.dateRange) {
          showError('Please fill in host name and date range');
          hideLoading();
          return;
        }
        
        if (summaryData.classes.length === 0) {
          showError('Please add at least one class');
          hideLoading();
          return;
        }
        
        let savedId;
        if (currentSummaryId) {
          // Update existing
          await updateInFirebase(currentSummaryId, summaryData);
          showSuccess('Summary updated successfully!');
        } else {
          // Save new summary
          savedId = await saveToFirebase(summaryData);
          currentSummaryId = savedId;
          showSuccess('Summary saved successfully!');
        }

        hideLoading();
        
      } catch (error) {
        console.error('Error saving summary:', error);
        showError('Failed to save summary: ' + error.message);
        hideLoading();
      }
    };

    window.generateReport = function() {
      // Validate data first
      if (!summaryData.hostName || !summaryData.dateRange) {
        showError('Please fill in host name and date range before generating report');
        return;
      }

      if (summaryData.classes.length === 0) {
        showError('Please add at least one class before generating report');
        return;
      }

      // For now, show alert with normalized data
      const stats = calculateSummaryStatistics(summaryData);
      
      alert(`Report would be generated with the following data:
      
Host: ${summaryData.hostName}
Date Range: ${summaryData.dateRange}
Total Classes: ${stats.totalClasses}
Total Entries: ${stats.totalEntries}
Total Runs: ${stats.totalRuns}
Qualifying Runs: ${stats.qualifyingRuns}

This would integrate with your existing PDF generation system.`);
    };

    // ========================================
    // UTILITY FUNCTIONS
    // ========================================

    function calculateSummaryStatistics(data) {
      let totalEntries = 0;
      let totalRuns = 0;
      let qualifyingRuns = 0;
      
      data.classes.forEach(classItem => {
        totalEntries += classItem.entries ? classItem.entries.length : 0;
        
        if (classItem.entries && classItem.dates) {
          classItem.entries.forEach(entry => {
            if (entry.results) {
              entry.results.forEach(result => {
                if (result) {
                  totalRuns++;
                  if (result === 'Pass') {
                    qualifyingRuns++;
                  }
                }
              });
            }
          });
        }
      });
      
      return {
        totalClasses: data.classes.length,
        totalEntries: totalEntries,
        totalRuns: totalRuns,
        qualifyingRuns: qualifyingRuns
      };
    }

    function showLoading(message) {
      const loadingEl = document.getElementById('loadingMessage');
      loadingEl.textContent = message;
      loadingEl.style.display = 'block';
    }

    function hideLoading() {
      document.getElementById('loadingMessage').style.display = 'none';
    }

    function showError(message) {
      const errorEl = document.getElementById('errorMessage');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
      setTimeout(() => {
        errorEl.style.display = 'none';
      }, 5000);
    }

    function showSuccess(message) {
      const successEl = document.getElementById('successMessage');
      successEl.textContent = message;
      successEl.style.display = 'block';
      setTimeout(() => {
        successEl.style.display = 'none';
      }, 3000);
    }

    // Make functions globally available
    window.removeClass = removeClass;
    window.updateClassName = updateClassName;
    window.addDate = addDate;
    window.removeDate = removeDate;
    window.updateDate = updateDate;
    window.addEntry = addEntry;
    window.removeEntry = removeEntry;
    window.updateEntry = updateEntry;
    window.updateResult = updateResult;

    console.log("Class Summary Generator loaded successfully with standardized field names");
  </script>
</body>
</html>
